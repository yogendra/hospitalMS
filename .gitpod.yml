# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

tasks:

  - name: YugabyteDB Voyager Helper Script Setup
    before: |
      docker pull yugabytedb/yb-voyager:latest
    command: |      
      wget -O ./yb-voyager https://raw.githubusercontent.com/yugabyte/yb-voyager/main/docker/yb-voyager-docker && chmod +x ./yb-voyager && sudo mv yb-voyager /usr/local/bin/yb-voyager
    
  - name: PHP
    openMode: split-left
    init: |
      cp .env.example .env &&
      sed -i "s#APP_URL=http://127.0.0.1:8000/#APP_URL=$(gp url 8000)#g" .env
      composer install --ignore-platform-reqs
      php artisan key:generate
      php artisan storage:link
      php artisan serve
    

  - name: Node
    init: npm install
    command: |
      npm run dev
      npm run watch
  
  - name: Host Shell
    openMode: split-right
    command: |
      docker compose up -d
      

  - name: Migration
    openIn: bottom
    openMode: tab-after
    command: |
      docker compose exec yb-voyager bash -l 
  
  - name: YB SQL Shell
    openIn: bottom
    openMode: tab-after
    command: |
      gp ports await 5433
      docker compose exec yugabyte ysqlsh -h yugabyte

ports:
  - port: 3306
    onOpen: ignore
    name: MySQL Database Port
  - port: 5433
    onOpen: ignore
    name: YB - YSQL
  - port: 15433
    name: YB - UI
    onOpen: open-browser
  - port: 7000
    name: YB - Master
    onOpen: ignore
  - port: 9000
    name: YB - TServer
    onOpen: ignore


